<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>å¥åº·éº»é›€ã‚ã„ã‚ã„</title>

<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

<style>
body { font-size:18px; padding:10px; }
button { font-size:18px; padding:10px; margin:5px; }
.name { margin:4px 0; }
</style>

</head>
<body>

<h2>ğŸ€„ å‚åŠ ã®ç”³ã—è¾¼ã¿</h2>

<input id="date" placeholder="æ—¥ä»˜ã‚’é¸æŠ">

<div style="margin-top:10px">
  <button onclick="join()">å‚åŠ ã™ã‚‹</button>
  <button onclick="cancel()">ã‚„ã‚ã‚‹</button>
</div>

<h3>å‚åŠ äºˆå®š</h3>
<div id="list"></div>

<script>
const LIFF_ID = "ã‚ãªãŸã®LIFF IDã«ç½®ãæ›ãˆ";

let profile;

flatpickr("#date", {
  onChange: loadList
});

async function init() {
  await liff.init({ liffId: LIFF_ID });
  profile = await liff.getProfile();
}
init();

async function join() {
  const date = document.getElementById("date").value;

  await fetch("/join", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({
      date: date,
      user_id: profile.userId,
      name: profile.displayName
    })
  });

  loadList();
}

async function cancel() {
  const date = document.getElementById("date").value;

  await fetch("/cancel", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({
      date: date,
      user_id: profile.userId
    })
  });

  loadList();
}

async function loadList() {
  const date = document.getElementById("date").value;
  if (!date) return;

  const res = await fetch("/list?date=" + date);
  const users = await res.json();

  document.getElementById("list").innerHTML =
    users.map(u => `<div class='name'>ãƒ»${u}</div>`).join("");
}
</script>

</body>
</html>
